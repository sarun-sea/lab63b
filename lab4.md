# การทดลองที่ 4 การเขียนโปรแกรมอินพุทสัญญาณดิจิทัล

## วัตถุประสงค์ 
1. เพื่อนำสัญญาณ input ภายนอกเข้ามายังภายใน microcontroller
2. เพื่อให้เข้าใจการทำงานของสัญญาณ สังเกต output ที่จะเกิดขึ้น 
3. เพื่อให้ใช้ sensor ในการดู input/output ของสภาพแวดล้อมได้

## อุปกรณ์ที่ใช้ 
1. CPU
2. adapter
3. sensorแสง
4. หลอด LED เปล่งแสง
5. microcontroller ESP-01
6. อุปกรณ์เชื่อมต่อ USB เข้าไปยัง serial

## แหล่งข้อมูลเพื่อการศึกษา
https://www.youtube.com/watch?v=nFqoZT26U5k

## วิธีการทำการทดลอง 
1. ทำการเสียบ microcontroller เข้าทาง serial port ของ USB 
2. ดูที่ตัวอย่างโปรแกรม ที่โฟลเดอร์ pattani
- พิมพ์ cd pattani เพื่อไปยังโฟลเดอร์
- แสดงโฟลเดอร์ ซึ่งมีโปรแกรมตัวอย่าง 9 โปรแกรม
  - ไปที่ตัวอย่างที่ 4
    - พิมพ์ cd 04_Input-port
3. ดู source code program โดยจะแสดงเป็นสองส่วน
- พิมพ์ vi src/main.cpp
  - ส่วน set up
    - set up ให้ io port ที่มี 2 อัน
      - port 0 (สายสีขาว) เป็น input
      - port 2 (สายสีเหลือง) เป็น output
  - ส่วน loop
    - digitalRead() หมายถึง การอ่านข้อมูลจาก port ซึ่งในตัวอย่างหมายถึง port 0 (ข้อมูลที่อ่านได้เป็นข้อมูล digital ซึ่งมีแค่ค่า 0 หรือ 1)
      - หากค่าที่อ่านได้ เป็น 1 ให้ LOW ไปที่ port 2 (หากเป็นหลอดไฟหมายถึงไฟดับ)
      - หากค่าที่อ่านได้ เป็น 0 ให้ HIGH ไปที่ port 2 (หากเป็นหลอดไฟหมายถึงไฟติด)
    โดยในที่นี้หมายความว่า port 0 เป็นตัวควบคุมสัญญาณ input ให้ไฟเปิด หรือ ปิด
    
javascript
#include <Arduino.h>
#include <ESP8266WiFi.h>

int cnt = 0;

void setup()
{
 Serial.begin(115200);
 pinMode(0, INPUT);
 pinMode(2, OUTPUT);
 Serial.println("\n\n\n");
}

void loop()
{
 int val = digitalRead(0);
 Serial.printf("======= read %d\n", val);
 if(val==1) {
  digitalWrite(2, LOW);
 } else {
  digitalWrite(2, HIGH);
 }
 delay(100);
}

4. อัพโหลดโปรแกรมเข้าไปใน microcontroller
 - พิมพ์ pio run -t upload
 - ทำการกดปุ่มสีดำ เพื่อให้ทำการอัพโหลดได้
 - เมื่อโปรแกรมถูกอัพโหลดเสร็จสิ้น โปรแกรมจะทำงานโดยการตรวจสอบที่ port 0 ว่ามี input มาหรือไม่
    - ถ้า input เป็น 1 ไฟจะติดที่ port 2
    - ถ้า input เป็น 0 ไฟจะไม่ติด
     
![image](https://user-images.githubusercontent.com/80879966/112139035-d8345c00-8c04-11eb-8b8b-cbdebca7f3c4.jpg)

  - พิมพ์ pio device monitor
    - ค่าที่อ่านได้เป็น 1 ตลอด ดังภาพ

![image](https://user-images.githubusercontent.com/80879966/112141149-86410580-8c07-11eb-8024-c3718b21e5cb.jpg)

- สายไฟเส้นสีขาว คือ port 0 ถ้าเอาสายไฟเส้นนี้ไปจิ้มจะมีค่าเป็น 0 Volt
  - นำสายไฟเส้นสีขาว จิ้มกับช่องที่มีสายสีดำเสียบอยู่ output อ่านค่าได้เป็น 0 ดังภาพ
  
![image](https://user-images.githubusercontent.com/80879966/112145978-9bb92e00-8c0d-11eb-9cfd-d1d932cd2504.jpg)
  
  - ปล่อยสายไฟเส้นสีขาวออกจาก ช่องที่มีสายสีดำ output เปลี่ยนกลับเป็น 1
  - นำสายไฟสีขาวไปจิ้มที่เส้นสีแดง หรือ HIGH(on) out put อ่านค่าได้เป็น 1 เช่นเดียวกัน

![image](https://user-images.githubusercontent.com/80879966/112145984-9d82f180-8c0d-11eb-9977-d7e8e5682249.jpg)
  
  microcontroller ESP-01 ตามปกติเราจะกดที่ปุ่มสีดำที่ต้องกดตอนโปรแกรมที่ผ่านมา ซึ่งในการทดลองนี้ปุ่มสีดำได้ต่ออยู่กับ port 0 
  - เมื่อลองกดที่ปุ่มสีดำ ค่าที่ได้ออกมาจะมีค่าเช่นเดียวกับการกดport 0 ส่งผลให้ไฟติดดังภาพ

![image](https://user-images.githubusercontent.com/80879966/112144832-3add2600-8c0c-11eb-86ea-446ec0fa337f.jpg)

  - เมื่อปล่อยมือจากปุ่มสีดำ ไฟจะดับ และค่าที่อ่านได้เป็น 1 ดังภาพ

![image](https://user-images.githubusercontent.com/80879966/112144869-3dd81680-8c0c-11eb-908e-643573ce9f53.jpg)

5. นำ CPU มาต่อกับ sensorแสง (sensorแสงนั้นต่ออยู่กับตัวต้านทาน)
- ขาข้างแรก ต่อกับไฟเลี้ยงของCPU เส้นสีแดง (ขนาด 3 Volt)
- ขาถัดมา ต่อกับ resistor เข้าไปต่อกับ port 0(ต่อภายหลัง)
- อีกขา ต่อกับเส้นสีดำ หรือ ground

(ภาพแสดงการต่อขาของ sensorแสง เข้ากับ CPU)
![image](https://user-images.githubusercontent.com/80879966/112153543-f2c30100-8c15-11eb-815a-4ae3df03f124.jpg)

- นำ input เส้นสีขาวต่อกับ sensor 
  - ไฟ LED จะสว่าง เมื่อ sensor โดนแสงสว่าง ค่าที่อ่านได้เป็น 0 ดังภาพ

![image](https://user-images.githubusercontent.com/80879966/112155932-5f3eff80-8c18-11eb-8005-e237aa2f2665.jpg)

  - ไฟ LED จะดับ เมื่อนำนิ้วไปปิดหน้า sensor ค่าที่อ่านได้เป็น 1 ดังภาพ

![image](https://user-images.githubusercontent.com/80879966/112155944-6108c300-8c18-11eb-81e2-777c84f642a9.jpg)

## การบันทึกผลการทดลอง 

**ก่อนทำการต่อ sensorแสง**

สายสีขาวเมื่อจิ้มสายสีดำจะได้เลข  0  ไฟติด
สายสีขาวนำออกจากช่องสายสีดำจะได้  1  ไฟดับ
สายสีขาวเมื่อจิ้มสายสีแดงจะได้ 1  ไฟดับ
เมื่อกดปุ่มสีดจะได้เลข  0  ไฟติด
เมื่อปล่อยมือจากปุ่มสีดจะได้ำ  1  ไฟดับ

**หลังต่อ sensorแสง**
 
เมื่อ sensor ไม่ถูกบังจะได้เลข  0  ไฟติด
เมื่อ sensor ถูกบดบัง  1  ไฟดับ

## อภิปรายผลการทดลอง 
- จากการทดลอง เมื่อโค้ดที่ถูกอ่านมีค่าเป็น 0 หมายถึง หลอดไฟจะสว่าง ในขณะเดียวกัน เมื่อค่าที่ถูกอ่านเป็น 1 หลอดไฟจะดับ 
- เมื่อทำการต่อ sensorแสง หากตัวsensorถูกบดบัง ค่าจะถูกอ่านเป็น 1 หลอดไฟจะดับ ในขณะเดียวกัน เมื่อsensorแสงไม่ถูกบัง หลอดไฟจะสว่าง

## คำถามหลังการทดลอง 
จากข้อมูลการทดลองสามารถนำไปใช้ในชีวิตประจำวันอย่างไรได้บ้าง
-   ตอบ ไฟตามท้องถนนที่ติดตอนกลางคืน ไฟตามอาคารหากมี sensor วัดแสง
